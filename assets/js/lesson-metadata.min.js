function cwsSenseiLessonMetadataReady(){jQuery("input.gapfill-field").each(function(){jQuery(this).change(function(){var e=jQuery(this).parent("div").find("input[name=add_question_right_answer_gapfill_pre]").val(),t=jQuery(this).parent("div").find("input[name=add_question_right_answer_gapfill_gap]").val(),s=jQuery(this).parent("div").find("input[name=add_question_right_answer_gapfill_post]").val();jQuery(this).parent("div").find("p.gapfill-preview").html(e+" <u>"+t+"</u> "+s)}),jQuery(this).keyup(function(){var e=jQuery(this).parent("div").find("input[name=add_question_right_answer_gapfill_pre]").val(),t=jQuery(this).parent("div").find("input[name=add_question_right_answer_gapfill_gap]").val(),s=jQuery(this).parent("div").find("input[name=add_question_right_answer_gapfill_post]").val();jQuery(this).parent("div").find("p.gapfill-preview").html(e+" <u>"+t+"</u> "+s)})}),jQuery("#add-quiz-metadata").on("change","#quiz_grade_type",function(){jQuery.fn.saveQuizGradeType()}),jQuery("#lesson-complexity-options").exists()&&jQuery("#lesson-complexity-options").select2({width:"resolve"}),jQuery("#lesson-prerequisite-options").exists()&&jQuery("#lesson-prerequisite-options").select2({width:"resolve"}),jQuery("#lesson-course-options").exists()&&jQuery("#lesson-course-options").select2({width:"resolve"}),jQuery("#course-prerequisite-options").exists()&&jQuery("#course-prerequisite-options").select2({width:"resolve"}),jQuery("#lesson-course-details #course-category-options").exists()&&jQuery("#lesson-course-details #course-category-options").select2({width:"resolve"}),jQuery("select#course-woocommerce-product-options").exists()&&jQuery("select#course-woocommerce-product-options").select2({width:"resolve"}),jQuery("#add-question-type-options").exists()&&jQuery("#add-question-type-options").select2({width:"resolve"}),jQuery("#add-question-category-options").exists()&&jQuery("#add-question-category-options").select2({width:"resolve"}),jQuery("#add-multiple-question-options").exists()&&jQuery("#add-multiple-question-options").select2({width:"resolve"}),jQuery("#course-wc-product #course-woocommerce-product-options").exists()&&jQuery("#course-woocommerce-product-options").select2({width:"resolve"}),jQuery("#add-multiple-question-category-options").exists()&&jQuery("#add-multiple-question-category-options").select2({width:"resolve"}),jQuery("div.woothemes-sensei-settings form select").each(function(){jQuery(this).hasClass("range-input")||jQuery(this).select2({width:"resolve"})}),jQuery("#lesson-course-details").addClass("hidden"),jQuery("#lesson-course-add").click(function(){jQuery("#lesson-course-actions").hide(),jQuery("#lesson-course-details").removeClass("hidden")}),jQuery("#lesson-course-details p").on("click","a.lesson_course_cancel",function(){jQuery("#lesson-course-actions").show(),jQuery("#lesson-course-details").addClass("hidden")}),jQuery("#lesson-course-details p").on("click","a.lesson_course_save",function(){if(jQuery.fn.validateCourseInput()){var e="";return e+="course_prerequisite="+jQuery("#course-prerequisite-options").val(),e+="&course_woocommerce_product="+jQuery("#course-woocommerce-product-options").val(),e+="&course_category="+jQuery("#course-category-options").val(),e+="&course_title="+encodeURIComponent(jQuery("#course-title").attr("value")),e+="&course_content="+encodeURIComponent(jQuery("#course-content").attr("value")),e+="&action=add",jQuery.post(ajaxurl,{action:"lesson_add_course",lesson_add_course_nonce:woo_localized_data.lesson_add_course_nonce,data:e},function(e){0<e&&(jQuery("#lesson-course-actions").show(),jQuery("#lesson-course-details").addClass("hidden"),jQuery("#lesson-course-options").append(jQuery("<option></option>").attr("value",e).text(jQuery("#course-title").attr("value"))),jQuery("#lesson-course-options").val(e).trigger("change"))}),!1}jQuery("#course-title").focus()}),jQuery("#add-question-actions").on("change","select.question-type-select",function(){var e=jQuery(this).val();switch(jQuery("#add-new-question").find("div.question_default_fields").hide(),jQuery("#add-new-question").find("div.question_boolean_fields").hide(),jQuery("#add-new-question").find("div.question_gapfill_fields").hide(),jQuery("#add-new-question").find("div.question_multiline_fields").hide(),jQuery("#add-new-question").find("div.question_singleline_fields").hide(),jQuery("#add-new-question").find("div.question_fileupload_fields").hide(),jQuery(".add_question_random_order").hide(),e){case"multiple-choice":jQuery("#add-new-question").find("div.question_default_fields").show(),jQuery(".add_question_random_order").show();break;case"boolean":jQuery("#add-new-question").find("div.question_boolean_fields").show();break;case"gap-fill":jQuery("#add-new-question").find("div.question_gapfill_fields").show();break;case"multi-line":jQuery("#add-new-question").find("div.question_multiline_fields").show();break;case"single-line":jQuery("#add-new-question").find("div.question_singleline_fields").show();break;case"file-upload":jQuery("#add-new-question").find("div.question_fileupload_fields").show()}}),jQuery("#add-question-metadata").on("click","a.question_table_edit",function(){var e=jQuery(this).closest("tr").next("tr").find(".question_original_counter").text();jQuery("#add-question-actions button.add_question_answer").removeClass("hidden"),jQuery.fn.resetAddQuestionForm(),jQuery.fn.resetQuestionTable(),jQuery(this).closest("tr").next("tr").removeClass("hidden"),jQuery("#question_"+e).focus()}),jQuery("#add-question-metadata").on("click","a.lesson_question_cancel",function(){jQuery(this).closest("tr.question-quick-edit").addClass("hidden")}),jQuery("#add-new-question").on("click","a.add_question_save",function(){var e="",t="multiple-choice",s="",i="true";if(jQuery.fn.validateQuestionInput("add",jQuery(this))){e+="quiz_id="+jQuery("#quiz_id").attr("value"),e+="&action=add",""!=jQuery("#add-question-type-options").val()&&(t=jQuery("#add-question-type-options").val()),""!=jQuery("#add-question-category-options").val()&&(s=jQuery("#add-question-category-options").val());var n="question_default_fields";switch(t){case"multiple-choice":n="question_default_fields";break;case"boolean":n="question_boolean_fields";break;case"gap-fill":n="question_gapfill_fields";break;case"multi-line":n="question_multiline_fields";break;case"single-line":n="question_singleline_fields";break;case"file-upload":n="question_fileupload_fields"}jQuery("#add-new-question").find("div.question_required_fields").find("input").each(function(){"radio"!=jQuery(this).attr("type")&&(e+="&"+jQuery(this).attr("name")+"="+encodeURIComponent(jQuery(this).attr("value")))}),""!=jQuery("#add-new-question").find("div.question_required_fields").find("textarea").val()&&(e+="&"+jQuery("#add-new-question").find("div.question_required_fields").find("textarea").attr("name")+"="+encodeURIComponent(jQuery("#add-new-question").find("div.question_required_fields").find("textarea").val()));var o=0;jQuery("#add-new-question").find("div."+n).find("input").each(function(){"radio"==jQuery(this).attr("type")?0==o&&(i=jQuery("input[name="+jQuery(this).attr("name")+"]:checked").attr("value"),e+="&"+jQuery(this).attr("name")+"="+encodeURIComponent(i),o++):e+="&"+jQuery(this).attr("name")+"="+encodeURIComponent(jQuery(this).attr("value"))}),""!=jQuery("#add_question_right_answer_essay").val()&&"question_essay_fields"==n&&(e+="&"+jQuery("#add_question_right_answer_essay").attr("name")+"="+encodeURIComponent(jQuery("#add_question_right_answer_essay").val())),""!=jQuery("#add_question_right_answer_multiline").val()&&"question_multiline_fields"==n&&(e+="&"+jQuery("#add_question_right_answer_multiline").attr("name")+"="+encodeURIComponent(jQuery("#add_question_right_answer_multiline").val())),e+="&question_type="+t,e+="&question_category="+s,questionGrade=jQuery("#add-question-grade").val(),e+="&question_grade="+questionGrade;var u=parseInt(jQuery("#question_counter").attr("value"));e+="&question_count="+u;var r=jQuery("#add-new-question").find(".answer_order").attr("value");e+="&answer_order="+r;var a=jQuery("#add-new-question").find(".question_media").attr("value");if(e+="&question_media="+a,""!=jQuery("div#add-new-question").find("div."+n).find(".answer_feedback").exists()){var d=jQuery("#add-new-question").find("div."+n).find(".answer_feedback").attr("value");e+="&answer_feedback="+encodeURIComponent(d)}var l="no";return jQuery("div#add-new-question").find(".random_order").is(":checked")&&(l="yes"),e+="&random_order="+l,jQuery.post(ajaxurl,{action:"lesson_update_question",lesson_update_question_nonce:woo_localized_data.lesson_update_question_nonce,data:e},function(e){if(e){jQuery.fn.updateQuestionCount(1,"+"),jQuery("#add-question-metadata table").append(e),jQuery.fn.resetAddQuestionForm(),jQuery.fn.checkQuizGradeType(t);var s=jQuery("#show_questions").attr("max");s++,jQuery("#show_questions").attr("max",s),jQuery.fn.scrollToElement("#lesson-quiz")}}),!1}jQuery("#add_question").focus()}),jQuery("#add-new-question").on("click","a.add_multiple_save",function(){var e="",t="",s=0;e+="quiz_id="+jQuery("#quiz_id").attr("value"),""!=jQuery("#add-multiple-question-count").val()&&(s=parseInt(jQuery("#add-multiple-question-count").val())),e+="&question_number="+s;var i=parseInt(jQuery("#add-multiple-question-count").attr("max"));if(s>i)return alert(woo_localized_data.too_many_for_cat),jQuery("#add-multiple-question-count").focus(),!1;""!=jQuery("#add-multiple-question-category-options").val()&&(t=jQuery("#add-multiple-question-category-options").val()),e+="&question_category="+t;if(e+="&question_count="+parseInt(jQuery("#question_counter").attr("value")),t&&s)return jQuery.post(ajaxurl,{action:"lesson_add_multiple_questions",lesson_add_multiple_questions_nonce:woo_localized_data.lesson_add_multiple_questions_nonce,data:e},function(e){if(e){jQuery("#add-multiple-question-category-options").val(""),jQuery("#add-multiple-question-count").val("1"),jQuery.fn.updateQuestionCount(s,"+"),jQuery("#add-question-metadata table").append(e),jQuery.fn.updateQuestionOrder();var t=jQuery("#show_questions").attr("max");t+=s,jQuery("#show_questions").attr("max",t),jQuery.fn.scrollToElement("#lesson-quiz")}}),!1;jQuery("#add-multiple-question-category-options").focus()}),jQuery("#add-question-metadata").on("click","a.question_table_save",function(){var e="",t="";if(jQuery.fn.validateQuestionInput("edit",jQuery(this))){e+="quiz_id="+jQuery("#quiz_id").attr("value"),e+="&action=save",jQuery(this).closest("td").children("input").each(function(){e+="&"+jQuery(this).attr("name")+"="+encodeURIComponent(jQuery(this).attr("value"))}),t=jQuery(this).closest("td").find("span.question_original_counter").text(),""!=jQuery(this).closest("td").find("input.question_type").val()&&(questionType=jQuery(this).closest("td").find("input.question_type").val());var s="question_default_fields";switch(questionType){case"multiple-choice":s="question_default_fields";break;case"boolean":s="question_boolean_fields";break;case"gap-fill":s="question_gapfill_fields";break;case"essay-paste":s="question_essay_fields";break;case"multi-line":s="question_multiline_fields";break;case"single-line":s="question_singleline_fields";break;case"file-upload":s="question_fileupload_fields"}jQuery(this).closest("td").find("div.question_required_fields").find("input").each(function(){"radio"!=jQuery(this).attr("type")&&(e+="&"+jQuery(this).attr("name")+"="+encodeURIComponent(jQuery(this).attr("value")))}),""!=jQuery(this).closest("td").find("div.question_required_fields").find("textarea").val()&&(e+="&"+jQuery(this).closest("td").find("div.question_required_fields").find("textarea").attr("name")+"="+encodeURIComponent(jQuery(this).closest("td").find("div.question_required_fields").find("textarea").val()));var i=0;jQuery(this).closest("td").find("div."+s).find("input").each(function(){"radio"==jQuery(this).attr("type")?0==i&&(e+="&"+jQuery(this).attr("name")+"="+encodeURIComponent(jQuery("input[name="+jQuery(this).attr("name")+"]:checked").attr("value")),i++):e+="&"+jQuery(this).attr("name")+"="+encodeURIComponent(jQuery(this).attr("value"))}),""!=jQuery(this).closest("td").find("div."+s).find("textarea").val()&&"question_multiline_fields"==s&&(e+="&"+jQuery(this).closest("td").find("div."+s).find("textarea").attr("name")+"="+encodeURIComponent(jQuery(this).closest("td").find("div."+s).find("textarea").val())),"question_fileupload_fields"==s&&jQuery(this).closest("td").find("div."+s).find("textarea").each(function(){e+="&"+jQuery(this).attr("name")+"="+encodeURIComponent(jQuery(this).val())}),e+="&question_type="+questionType,questionGrade=jQuery(this).closest("td").find("input.question_grade").val(),e+="&question_grade="+questionGrade;var n=parseInt(jQuery("#question_counter").attr("value"));e+="&question_count="+n;var o=jQuery(this).closest("td").find(".answer_order").attr("value");e+="&answer_order="+o;var u=jQuery(this).closest("td").find(".question_media").attr("value");if(e+="&question_media="+u,""!=jQuery(this).closest("td").find(".answer_feedback").exists()){var r=jQuery(this).closest("td").find(".answer_feedback").attr("value");e+="&answer_feedback="+encodeURIComponent(r)}var a="no";return jQuery(this).closest("td").find(".random_order").is(":checked")&&(a="yes"),e+="&random_order="+a,jQuery.post(ajaxurl,{action:"lesson_update_question",lesson_update_question_nonce:woo_localized_data.lesson_update_question_nonce,data:e},function(e){if(e){var s,i;s=jQuery("#question_"+t).closest("tr").find(".question_required_fields input[name=question] ").val(),jQuery("#question_"+t).closest("tr").prev().find(".question-title-column").html(s),i=jQuery("#question_"+t).closest("tr").find(".question_required_fields input[name=question_grade] ").val(),jQuery("#question_"+t).closest("tr").prev().find(".question-grade-column").html(i),jQuery("#question_"+t).closest("tr").addClass("hidden")}}),!1}}),jQuery("#add-question-metadata").on("click","a.question_table_delete",function(){var e="",t="";if(confirm(woo_localized_data.confirm_remove)){e+="&action=delete",jQuery(this).closest("tr").next("tr").find("td").find("input").each(function(){"question_id"==jQuery(this).attr("name")&&(jQuery(this).attr("value"),e+="&question_id="+jQuery(this).attr("value"))}),e+="&quiz_id="+jQuery("#quiz_id").attr("value"),t=jQuery(this).closest("tr").find("td.question-number span.number").text();var s=jQuery(this).closest("tbody");return jQuery.post(ajaxurl,{action:"lesson_update_question",lesson_update_question_nonce:woo_localized_data.lesson_update_question_nonce,data:e},function(e){if(e){jQuery("#add-question-metadata > table > tbody > tr").children("td").each(function(){if(jQuery(this).find("span.number").text()==t)return jQuery(this).closest("tr").next("tr").remove(),jQuery(this).closest("tr").remove(),!1}),jQuery.fn.updateQuestionCount(1,"-"),jQuery.fn.checkQuizGradeType(!1),jQuery.fn.updateAnswerOrder(s);var i=parseInt(jQuery("#show_questions").attr("max"));i--,jQuery("#show_questions").attr("max",i);parseInt(jQuery("#show_questions").val())>i&&jQuery("#show_questions").val(i)}}),!1}}),jQuery("#add-question-metadata").on("click","a.question_multiple_delete",function(){var e="";if(confirm(woo_localized_data.confirm_remove_multiple)){e+="question_id="+jQuery(this).attr("rel"),e+="&quiz_id="+jQuery("#quiz_id").attr("value");var t=jQuery(this).closest("tr").find("td.question-number span.number").text(),s=jQuery(this).closest("tr").find("td.question-number span.total-number").text();jQuery(this).closest("tbody");return jQuery.post(ajaxurl,{action:"lesson_remove_multiple_questions",lesson_remove_multiple_questions_nonce:woo_localized_data.lesson_remove_multiple_questions_nonce,data:e},function(e){if(e){jQuery("#add-question-metadata > table > tbody > tr").children("td").each(function(){if(jQuery(this).find("span.number").text()==t)return jQuery(this).closest("tr").remove(),!1}),jQuery.fn.updateQuestionCount(s,"-");var i=parseInt(jQuery("#show_questions").attr("max"));i-=s,jQuery("#show_questions").attr("max",i);parseInt(jQuery("#show_questions").val())>i&&jQuery("#show_questions").val(i)}}),!1}}),jQuery("#add-new-question").on("click","a.add_existing_save",function(){var e="",t="",s=0;if(jQuery("#existing-questions").find("input.existing-item").each(function(){if(jQuery(this).is(":checked")){var t=jQuery(this).val();e+=t+",",++s}}),e){t="questions="+e,t+="&quiz_id="+jQuery("#quiz_id").attr("value");return t+="&question_count="+parseInt(jQuery("#question_counter").attr("value")),jQuery.post(ajaxurl,{action:"lesson_add_existing_questions",lesson_add_existing_questions_nonce:woo_localized_data.lesson_add_existing_questions_nonce,data:t},function(e){if(e){jQuery.fn.updateQuestionCount(s,"+"),jQuery("#add-question-metadata table").append(e),jQuery.fn.checkQuizGradeType();var t=jQuery("#show_questions").attr("max");t+=s,jQuery("#show_questions").attr("max",t),jQuery.fn.scrollToElement("#lesson-quiz"),jQuery("#existing-questions").find("input.existing-item").each(function(){jQuery(this).removeAttr("checked")})}}),!1}}),jQuery("#existing-filter-button").click(function(){jQuery.fn.filterExistingQuestions(1)}),jQuery("#existing-pagination").on("click","a",function(){var e=parseInt(jQuery("#existing-page").val()),t=e;jQuery(this).hasClass("prev")?t=e-1:jQuery(this).hasClass("next")&&(t=e+1),t=parseInt(t),jQuery.fn.filterExistingQuestions(t)}),jQuery("#quiz-settings").on("change","#pass_required",function(){"checked"==jQuery(this).attr("checked")?jQuery(".form-field.quiz_passmark").removeClass("hidden"):(jQuery(".form-field.quiz_passmark").addClass("hidden"),jQuery("#quiz_passmark").val(0))}),jQuery("#quiz-settings").on("change","#random_question_order",function(){jQuery.fn.saveQuestionOrderRandom()}),jQuery("#add-question-main").on("blur",".question_answer",function(){var e=jQuery(this).val(),t=jQuery(this);return dataToPost="&answer_value="+e,jQuery.post(ajaxurl,{action:"question_get_answer_id",data:dataToPost},function(e){e&&(t.attr("rel",e),jQuery.fn.updateAnswerOrder(t.closest("div")))}),!1}),jQuery("#add-question-main").on("click",".add_wrong_answer_option",function(){var e=jQuery(this).attr("rel"),t=jQuery('input[name="question_wrong_answers[]"]').length-1,s='<label class="answer" for="question_'+e+"_wrong_answer_"+ ++t+'"><span>'+woo_localized_data.wrong_colon+'</span> <input type="text" id="question_'+e+"_wrong_answer_"+t+'" name="question_wrong_answers[]" value="" size="25" class="question_answer widefat" /> <a class="remove_answer_option"></a></label>';jQuery(this).closest("div").before(s)}),jQuery("#add-question-main").on("click",".add_right_answer_option",function(){var e=jQuery(this).attr("rel"),t=jQuery('input[name="question_right_answers[]"]').length-1,s='<label class="answer" for="question_'+e+"_right_answer_"+ ++t+'"><span>'+woo_localized_data.right_colon+'</span> <input type="text" id="question_'+e+"_right_answer_"+t+'" name="question_right_answers[]" value="" size="25" class="question_answer widefat" /> <a class="remove_answer_option"></a></label>';jQuery(this).closest("div").before(s)}),jQuery("#add-question-main").on("click",".remove_answer_option",function(){jQuery(this).closest("label.answer").remove()}),jQuery(".multiple-choice-answers").sortable({items:"label.answer"}),jQuery(".multiple-choice-answers").bind("sortstop",function(e,t){jQuery.fn.updateAnswerOrder(jQuery(this))}),jQuery("#sortable-questions").sortable({items:"tbody",start:function(e,t){t.placeholder.html("<tr><td colspan='5'>&nbsp;</td></tr>")}}),jQuery("#sortable-questions").bind("sortstop",function(e,t){jQuery.fn.updateQuestionOrder(),jQuery.fn.updateQuestionRows()}),jQuery("#add-question-main").on("click",".upload_media_file_button",function(e){e.preventDefault(),jQuery.fn.uploadQuestionMedia(jQuery(this))}),jQuery("#add-question-main").on("click",".delete_media_file_button",function(e){e.preventDefault(),jQuery.fn.deleteQuestionMedia(jQuery(this))}),jQuery("#add-question-main").on("click",".question_media_preview",function(e){e.preventDefault(),jQuery.fn.uploadQuestionMedia(jQuery(this).closest("div").find(".upload_media_file_button"))}),jQuery("#add-new-question .tab-content:not(:first)").addClass("hidden"),jQuery(".add-question-tabs .nav-tab").click(function(){var e=jQuery(this).attr("id")+"-content";jQuery("#add-new-question .nav-tab").removeClass("nav-tab-active"),jQuery(this).addClass("nav-tab-active"),jQuery("#add-new-question .tab-content").addClass("hidden"),jQuery("#"+e).removeClass("hidden")}),jQuery("#add-multiple-question-category-options").change(function(){var e="cat="+jQuery(this).val();jQuery.post(ajaxurl,{action:"get_question_category_limit",data:e},function(e){if(e){var t=parseInt(e);t&&jQuery("#add-multiple-question-count").attr("max",t)}})}),jQuery("#existing-table th.check-column input").click(function(){jQuery("#existing-questions").find(":checkbox").attr("checked",this.checked)}),jQuery("tbody#existing-questions").on("click","tr td:not(.cb)",function(){jQuery(this).closest("tr").find(":checkbox").each(function(){jQuery(this).prop("checked",!jQuery(this).prop("checked"))})}),jQuery("#lesson-complexity-options").exists()&&jQuery("#lesson-complexity-options").select2({width:"resolve"}),jQuery("#lesson-prerequisite-options").exists()&&jQuery("#lesson-prerequisite-options").select2({width:"resolve"}),jQuery("#lesson-course-options").exists()&&jQuery("#lesson-course-options").select2({width:"resolve"}),jQuery("#course-prerequisite-options").exists()&&jQuery("#course-prerequisite-options").select2({width:"resolve"}),jQuery("#course-category-options").exists()&&jQuery("#course-category-options").select2({width:"resolve"}),jQuery("#course-woocommerce-product-options").exists()&&"-"!=jQuery("#course-woocommerce-product-options").val()&&jQuery("#course-woocommerce-product-options").select2({width:"resolve"}),jQuery("#add-question-type-options").exists()&&jQuery("#add-question-type-options").select2({width:"resolve"}),jQuery("#add-question-category-options").exists()&&jQuery("#add-question-category-options").select2({width:"resolve"}),jQuery("#add-multiple-question-options").exists()&&jQuery("#add-multiple-question-options").select2({width:"resolve"}),jQuery("select#course-woocommerce-product-options").exists()&&jQuery("select#course-woocommerce-product-options").select2({width:"resolve"}),jQuery("#add-multiple-question-category-options").exists()&&jQuery("#add-multiple-question-category-options").select2({width:"resolve"}),jQuery("div.woothemes-sensei-settings form select").each(function(){jQuery(this).hasClass("range-input")||jQuery(this).select2({width:"resolve"})})}jQuery.fn.exists=function(){return this.length>0};