function cwsAddGetVarToUrl(e,s){var t="";s||(s=".cws-is-get-var"),jQuery(e).find(s).each(function(e,s){t+="&"+s.name+"="+s.value}),e.action+=t}function cwsSelectFilterAjax(){var e=jQuery("#cws_filter_object").val(),s=jQuery(".cws-"+e+"-select-filtered");if(e&&s.length){var t=jQuery(this).val();t&&(data="action=cws_ajax_form&"+this.name+"="+t+"&cws_filter_object="+e,data+=cwsUrl.substring(cwsUrl.indexOf("&page=course-wizard")+19),jQuery.post(ajaxurl,data,function(e,t,r){e&&s.html(e).focus().select2("open")}))}}function cwsAjaxLoadHistory(){history.pushState&&window.setTimeout(function(){window.addEventListener("popstate",function(e){cwsAjaxLink(document.URL)},!1)},1)}function cwsAjaxLink(e){if(cwsPreviousUrl=cwsUrl,"string"==typeof e)cwsUrlBeforeRedirect=cwsUrl=e;else{if(jQuery(e).hasClass("cws-no-ajax"))return!0;cwsUrlBeforeRedirect=cwsUrl=e.href}return data="action=cws_ajax_form",data+=cwsUrl.substring(cwsUrl.indexOf("&page=course-wizard")+19),jQuery.post(ajaxurl,data,cwsAjaxSuccess),!1}function cwsAjaxForm(e){if(jQuery(this).hasClass("cws-no-ajax")){var s=jQuery(this).serialize();return this.action+=(this.action.indexOf("?")>-1?"&":"?")+s,console.log(this.action),!0}if(jQuery("#cws-editor").length){var t="";t=jQuery("#wp-cws-editor-id-wrap").hasClass("html-active")?jQuery("#cws-editor-id").val():tinymce.activeEditor.getContent(),jQuery("#cws-editor").val(t)}s=jQuery(this).serialize();return s+="&action=cws_ajax_form",cwsAddGetVarToUrl(this,".cws-is-ajax-get-var"),cwsPreviousUrl=cwsUrl,cwsUrlBeforeRedirect=cwsUrl=this.action,s+=cwsUrl.substring(cwsUrl.indexOf("&page=course-wizard")+19),cwsAddGetVarToUrl(this),jQuery.post(ajaxurl,s,cwsAjaxSuccess),e.preventDefault(),!1}function cwsAjaxSuccess(e,s,t){if(""!==e){cwsDoTransition(e),jQuery(".cws-editor-hidden").hide();var r=t.getResponseHeader("X-Redirect-Url");r&&(cwsUrlBeforeRedirect=cwsUrl,cwsUrl=r),document.URL!==cwsUrl&&history.pushState(null,document.title,cwsUrl)}else cwsPreviewReload(cwsPreviewUrl)}function cwsDoTransition(e){var s=jQuery("#cws-wizard-screen"),t=jQuery(".cws-wizard-screen-ajax-content"),r=e;if(0!==cwsTransition){var i=jQuery("#cws-wizard-screen-transition"),a=jQuery(".cws-wizard");i.html(s.html()),t.html(r);var n=cwsTransition<0?" back":"";a.addClass("cws-before-transition"+n),window.setTimeout(function(){a.addClass("cws-is-transition"+n)},1),window.setTimeout(function(){i.html(""),a.removeClass("cws-is-transition cws-before-transition"+n),cwsTransition=0,cwsAjaxInit()},251)}else s.fadeOut("fast",function(){t.html(r),s.fadeIn("fast"),cwsAjaxInit()})}function cwsPreviewReload(e){var s=document.getElementById("cws-preview-iframe");if(!e&&s.src||e&&s.contentWindow.location.href===e){if(-1===cwsUrlBeforeRedirect.indexOf("cws_action=")||-1===cwsUrlBeforeRedirect.indexOf("cws_course="))return;var t=s.contentWindow.scrollX,r=s.contentWindow.scrollY;s.contentWindow.location.reload(!0),s.onload=function(){s.contentWindow.scrollTo(t,r)}}else s.src=e}function cwsCoursesReady(){jQuery(".cws-course-edit-link").click(function(e){if(!jQuery("#cws-select-post").val())return e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),jQuery("#cws-select-post").focus(),!1;this.href+=jQuery("#cws-select-post").val()})}function cwsSenseiModulesReady(){jQuery("#module-order-course").select2({width:"resolve"}),jQuery("select#lesson-module-options").select2({width:"resolve"}),jQuery(".sortable-module-list").sortable(),jQuery(".sortable-tab-list").disableSelection(),jQuery(".sortable-module-list").bind("sortstop",function(e,s){var t="";jQuery(this).find(".cws-order-item").each(function(e,s){if(e>0&&(t+=","),t+=jQuery(this).find("span").attr("rel"),jQuery(this).removeClass("alternate"),jQuery(this).removeClass("first"),jQuery(this).removeClass("last"),0==e)jQuery(this).addClass("first alternate");else{0==e%2&&jQuery(this).addClass("alternate")}});var r=jQuery('input[name="module-order"]').attr("value");jQuery('input[name="module-order"]').attr("value",t),t&&r!==t&&jQuery(this).closest(".cws-form").submit()})}function cwsSenseiLessonsReady(){jQuery.fn.fixOrderingList=function(e,s){e.find("."+s).each(function(e,s){if(jQuery(this).removeClass("alternate"),jQuery(this).removeClass("first"),jQuery(this).removeClass("last"),0==e)jQuery(this).addClass("first alternate");else{0==e%2&&jQuery(this).addClass("alternate")}})},jQuery(".sortable-lesson-list").sortable(),jQuery(".sortable-tab-list").disableSelection(),jQuery(".sortable-lesson-list").bind("sortstop",function(e,s){var t="",r=jQuery(this).attr("data-module_id"),i="lesson-order";0!=r&&(i="lesson-order-module-"+r),jQuery(this).find(".lesson").each(function(e,s){e>0&&(t+=","),t+=jQuery(this).find("span").attr("rel")});var a=jQuery('input[name="'+i+'"]').attr("value");jQuery('input[name="'+i+'"]').attr("value",t),jQuery.fn.fixOrderingList(jQuery(this),"lesson"),t&&a!==t&&jQuery(this).closest(".cws-form").submit()})}function cwsSenseiQuestionsReady(){jQuery("#cws_add_question_count").attr("value",parseInt(jQuery("#question_counter").attr("value"))),jQuery(".sortable-question-list").sortable(),jQuery(".sortable-tab-list").disableSelection(),jQuery(".sortable-question-list").bind("sortstop",function(e,s){var t="";jQuery(this).find(".question").each(function(e,s){if(e>0&&(t+=","),t+=jQuery(this).find("span").attr("rel"),jQuery(this).removeClass("alternate"),jQuery(this).removeClass("first"),jQuery(this).removeClass("last"),0==e)jQuery(this).addClass("first alternate");else{0==e%2&&jQuery(this).addClass("alternate")}});var r=jQuery('input[name="question-order"]').attr("value");jQuery('input[name="question-order"]').attr("value",t),t&&r!==t&&jQuery(this).closest(".cws-form").submit()})}jQuery(document).ready(function(e){cwsAjaxInit(1),cwsAjaxLoadHistory(),jQuery.ajaxPrefilter("script",function(e){e.cache=!0}),jQuery("#cws-wizard-screen").on("click",".cws-link",function(e){return"none"==jQuery(this).css("pointer-events")?e.preventDefault():cwsAjaxLink(this)}),jQuery("#cws-wizard-screen").on("submit",".cws-form",cwsAjaxForm),jQuery("#cws-wizard-screen").on("click",".cws-back-button",function(e){cwsTransition=-1}),jQuery("#cws-wizard-screen").on("click",".cws-order-items-link",function(e){cwsTransition=1}),jQuery(".cws-wizard").on("click",".cws-preview-button",function(e){jQuery("#cws-preview.wp-full-overlay-main, .cws-preview-button").toggleClass("show"),e.preventDefault()})}),cwsTransition=0,cwsAjaxInit=function(e){if(jQuery(".cws-select2").each(function(e,s){var t=jQuery(s);t.hasClass("cws-select-filter")&&t.on("change",cwsSelectFilterAjax),t.select2({width:"100%",dropdownParent:t.parent()})}),cwsCoursesReady(),cwsSenseiModulesReady(),cwsSenseiLessonsReady(),cwsSenseiQuestionsReady(),jQuery(".sortable-lesson-list").on("click",".cws-order-remove-link",function(e){confirm(cwsL10n.lessonRemoveConfirmDelete)&&(this.href+="&cws_action=delete")}),jQuery(".sortable-module-list").on("click",".module .cws-order-remove-link",function(e){confirm(cwsL10n.moduleRemoveConfirmDelete)&&(this.href+="&cws_action=delete")}),jQuery("#cws-editor").length){var s=document.getElementById("cws-editor").value;!e&&tinymce&&tinymce.activeEditor&&tinymce.activeEditor.setContent(s),jQuery("textarea[name=cws-editor-textarea]").val(s),jQuery(".cws-editor-hidden").show()}return e||(cwsPreviewReload(cwsPreviewUrl),cwsSenseiLessonMetadataReady(),e)};var cwsUrl=cwsPreviousUrl=cwsUrlBeforeRedirect=cwsPreviewUrl="";jQuery(document).ajaxSend(function(e,s,t){!t.data||t.data.indexOf("action=cws_ajax_form")<0||(jQuery('input[type="submit"],input[type="button"],a').css("pointer-events","none"),jQuery(".cws-wizard .spinner").addClass("is-active"))}).ajaxComplete(function(e,s,t){!t.data||t.data.indexOf("action=cws_ajax_form")<0||(jQuery('input[type="submit"],input[type="button"],a').css("pointer-events",""),jQuery(".cws-wizard .spinner").removeClass("is-active"))}).ajaxError(function(e,s,t,r){if(t.data&&!(t.data.indexOf("action=cws_ajax_form")<0)){var i=jQuery("#cws-wizard-screen"),a=s.status,n='<div class="notice error cws-ajax-error"><p>AJAX error. '+a+" ";0===a?n+="Check your Network":"parsererror"==status?n+="JSON parse failed":"timeout"==status?n+="Request Timeout":"abort"==status?n+="Request Aborted":n+=r,n+=".</p></div>",i.html(n+'<iframe width="100%" height="100%" srcdoc="'+s.responseText+'"></iframe>')}});